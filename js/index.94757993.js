import{_ as y,g as O}from"./index.ff3add46.js";import{o as w,c as C,I as $,J as U,ah as s,V as l,P as i,S as d,a as b,T as k,U as _,O as E,F as P,ar as T,a9 as z,Q as A}from"./vendor-vue.cefe3aef.js";import{F as R}from"./vendor-lib.a8c0b8df.js";import{J as L}from"./jszip.min.296c2dbd.js";import{C as B}from"./ConnectStatus.59f85ed1.js";import{E as j}from"./ExpireProgress.739bca14.js";import"./element-plus.af689926.js";import"./element-icon.1fe9d2a8.js";import"./_commonjs-dynamic-modules.377d74e3.js";const q={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],ssl_certificate:[{message:"\u8BC1\u4E66\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],start_time:[{message:"\u7B7E\u53D1\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],expire_time:[{message:"\u8FC7\u671F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],create_time:[{message:"\u521B\u5EFA\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]};const I={name:"FileDrop",props:{},components:{},data(){return{uuid:O(),isOver:!1}},computed:{},methods:{dropEvent(t){t.stopPropagation(),t.preventDefault(),this.isOver=!1,this.handleDragLeave(),this.uploadFile(t.dataTransfer.files)},uploadFile(t){this.$emit("on-files",t),this.fileUpload&&this.fileUpload(t)},handleDragEnter(){this.$emit("on-dragenter")},handleDragLeave(){this.$emit("on-dragleave")}},beforeUnmount(){this.$refs.FileDrop.removeEventListener("drop",this.dropEvent,!1)},mounted(){let t=this.$refs.FileDrop;t.addEventListener("drop",this.dropEvent,!1),t.addEventListener("dragleave",e=>{e.stopPropagation(),e.preventDefault(),this.isOver=!1,this.handleDragLeave()}),t.addEventListener("dragenter",e=>{e.stopPropagation(),e.preventDefault(),this.isOver=!0,this.handleDragEnter()}),t.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault()})},created(){}};function N(t,e,r,h,a,n){return w(),C("div",{class:U(["FileDrop",{"FileDrop--active":a.isOver}]),ref:"FileDrop"},[$(t.$slots,"default")],2)}const J=y(I,[["render",N]]);const K={name:"",props:{row:{type:Object,default:null}},components:{FileDrop:J},data(){return{rules:q,form:{domain:"",ssl_certificate:"",ssl_certificate_key:"",start_time:"",expire_time:"",comment:""}}},computed:{},methods:{async getData(){if(this.row){let t={certificate_id:this.row.certificate_id};const e=await this.$http.getCertificateById(t);if(e.code!=0)return;let r=e.data;this.form.domain=r.domain,this.form.ssl_certificate=r.ssl_certificate,this.form.ssl_certificate_key=r.ssl_certificate_key,this.form.start_time=r.start_time,this.form.expire_time=r.expire_time,this.form.comment=r.comment}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(t=>{if(t)this.confirmSubmit();else return!1})},async confirmSubmit(){let t=this.$loading({fullscreen:!0}),e={domain:this.form.domain,ssl_certificate:this.form.ssl_certificate,ssl_certificate_key:this.form.ssl_certificate_key,start_time:this.form.start_time,expire_time:this.form.expire_time,comment:this.form.comment},r=null;this.row?(e.certificate_id=this.row.certificate_id,r=await this.$http.updateCertificateById(e)):r=await this.$http.addCertificate(e),r.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(r.msg),this.$nextTick(()=>{t.close()})},async parsePublicCert(){let t={certificate:this.form.ssl_certificate};const e=await this.$http.parsePublicCert(t);console.log(e),e.ok&&e.data&&(this.form.domain=e.data.subject.CN,this.form.start_time=e.data.notBefore,this.form.expire_time=e.data.notAfter),this.$refs.form.validate()},handleCertificateChange(){!this.form.ssl_certificate||this.parsePublicCert()},handleFileUpload(t,e){if(console.log(t,e),e&&e.length>0){let r=new FileReader;r.readAsText(e[0]),r.onload=h=>{this.form[t]=h.target.result,t=="ssl_certificate"&&this.handleCertificateChange()}}},handleDragenter(t){console.log("handleDragenter",t),this.$refs[t].focus()},handleDragleave(t){console.log("handleDragleave",t),this.$refs[t].blur()}},created(){this.getData()}},Q={class:"flex"},Z={class:"text-center"};function G(t,e,r,h,a,n){const m=s("el-input"),p=s("el-form-item"),u=s("FileDrop"),g=s("el-date-picker"),v=s("el-form"),D=s("el-button");return w(),C("div",null,[l(v,{ref:"form",model:a.form,rules:a.rules,"label-width":"100px"},{default:i(()=>[d(" \u57DF\u540D "),l(p,{label:"\u57DF\u540D",prop:"domain"},{default:i(()=>[l(m,{type:"text",modelValue:a.form.domain,"onUpdate:modelValue":e[0]||(e[0]=o=>a.form.domain=o),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"},null,8,["modelValue"])]),_:1}),d(" \u8BC1\u4E66 "),l(p,{label:"\u8BC1\u4E66",prop:"ssl_certificate"},{default:i(()=>[l(u,{onOnFiles:e[2]||(e[2]=o=>n.handleFileUpload("ssl_certificate",o)),onOnDragenter:e[3]||(e[3]=o=>n.handleDragenter("ssl_certificate_input")),onOnDragleave:e[4]||(e[4]=o=>n.handleDragleave("ssl_certificate_input"))},{default:i(()=>[l(m,{ref:"ssl_certificate_input",type:"textarea",modelValue:a.form.ssl_certificate,"onUpdate:modelValue":e[1]||(e[1]=o=>a.form.ssl_certificate=o),placeholder:"\u8BC1\u4E66\u5185\u5BB9\uFF08.pem\u6587\u4EF6\uFF09\uFF0C\u652F\u6301\u62D6\u62FD\u4E0A\u4F20",rows:6,spellcheck:!1,onChange:n.handleCertificateChange},null,8,["modelValue","onChange"])]),_:1})]),_:1}),d(" \u8BC1\u4E66\u79C1\u94A5 "),l(p,{label:"\u8BC1\u4E66\u79C1\u94A5",prop:"ssl_certificate_key"},{default:i(()=>[l(u,{onOnFiles:e[6]||(e[6]=o=>n.handleFileUpload("ssl_certificate_key",o)),onOnDragenter:e[7]||(e[7]=o=>n.handleDragenter("ssl_certificate_key_input")),onOnDragleave:e[8]||(e[8]=o=>n.handleDragleave("ssl_certificate_key_input"))},{default:i(()=>[l(m,{ref:"ssl_certificate_key_input",type:"textarea",modelValue:a.form.ssl_certificate_key,"onUpdate:modelValue":e[5]||(e[5]=o=>a.form.ssl_certificate_key=o),placeholder:"\u8BC1\u4E66\u79C1\u94A5\u5185\u5BB9\uFF08.key\u6587\u4EF6\uFF09\uFF0C\u652F\u6301\u62D6\u62FD\u4E0A\u4F20",rows:6,spellcheck:!1},null,8,["modelValue"])]),_:1})]),_:1}),d(" \u7B7E\u53D1\u65F6\u95F4 "),b("div",Q,[l(p,{label:"\u7B7E\u53D1\u65F6\u95F4",prop:"start_time"},{default:i(()=>[l(g,{modelValue:a.form.start_time,"onUpdate:modelValue":e[9]||(e[9]=o=>a.form.start_time=o),type:"date",placeholder:"\u7B7E\u53D1\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),d(" \u8FC7\u671F\u65F6\u95F4 "),l(p,{label:"\u8FC7\u671F\u65F6\u95F4",prop:"expire_time"},{default:i(()=>[l(g,{modelValue:a.form.expire_time,"onUpdate:modelValue":e[10]||(e[10]=o=>a.form.expire_time=o),type:"date",placeholder:"\u8FC7\u671F\u65F6\u95F4"},null,8,["modelValue"])]),_:1})]),d(" \u5907\u6CE8 "),l(p,{label:"\u5907\u6CE8",prop:"comment"},{default:i(()=>[l(m,{type:"textarea",modelValue:a.form.comment,"onUpdate:modelValue":e[11]||(e[11]=o=>a.form.comment=o),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),d(" \u64CD\u4F5C "),b("div",Z,[l(D,{onClick:n.handleCancel},{default:i(()=>[k(_(t.$t("\u53D6\u6D88")),1)]),_:1},8,["onClick"]),l(D,{type:"primary",onClick:n.handleSubmit},{default:i(()=>[k(_(t.$t("\u786E\u5B9A")),1)]),_:1},8,["onClick"])])])}const H=y(K,[["render",G]]),M={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:H},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91\u8BC1\u4E66":"\u6DFB\u52A0\u8BC1\u4E66"},dialogVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function W(t,e,r,h,a,n){const m=s("DataForm"),p=s("el-dialog");return w(),C(P,null,[d(" \u7F16\u8F91\u6846 "),l(p,{title:n.dialogTitle,modelValue:n.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=u=>n.dialogVisible=u),width:"800px",center:"",top:"5vh","append-to-body":"","close-on-click-modal":!1},{default:i(()=>[n.dialogVisible?(w(),E(m,{key:0,row:r.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):d("v-if",!0)]),_:1},8,["title","modelValue"])],2112)}const F=y(M,[["render",W]]),X={name:"",components:{DataFormDialog:F,ConnectStatus:B,ExpireProgress:j},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(t){this.currentRow=t,this.dialogVisible=!0},async handleDeleteClick(t){let e={certificate_id:t.certificate_id};const r=await this.$http.deleteCertificateById(e);r.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(r.msg)},async handleStatusChange(t){let e={id:t.id};const r=await this.$http.function(e);r.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(r.msg)},handleUpdateSuccess(){this.$emit("on-success")},async downloadSSLFile(t){let e=t.domain;const r=new L;r.file(`${e}.pem`,t.ssl_certificate),r.file(`${e}.key`,t.ssl_certificate_key),r.generateAsync({type:"blob"}).then(function(h){R.saveAs(h,`${e}.zip`)})}},created(){}};function Y(t,e,r,h,a,n){const m=s("el-table-column"),p=s("ExpireProgress"),u=s("Download"),g=s("el-icon"),v=s("el-link"),D=s("Edit"),o=s("Delete"),V=s("el-popconfirm"),S=s("el-table"),f=s("DataFormDialog");return w(),C("div",null,[l(S,{data:r.list,stripe:"",border:""},{default:i(()=>[d(" \u57DF\u540D "),l(m,{label:"\u57DF\u540D","header-align":"center",align:"center",prop:"domain"},{default:i(c=>[b("span",null,_(c.row.domain||"-"),1)]),_:1}),d(" \u8BC1\u4E66\u5929\u6570 "),l(m,{label:t.$t("\u8BC1\u4E66\u5929\u6570"),"header-align":"center",align:"center",width:"110",sortable:"custom",prop:"expire_days"},{default:i(c=>[l(p,{startTime:c.row.start_time,endTime:c.row.expire_time},null,8,["startTime","endTime"])]),_:1},8,["label"]),d(" \u7B7E\u53D1\u65F6\u95F4 "),l(m,{label:"\u7B7E\u53D1\u65F6\u95F4","header-align":"center",align:"center",prop:"start_time",width:"180"},{default:i(c=>[b("span",null,_(c.row.start_date||"-"),1)]),_:1}),d(" \u8FC7\u671F\u65F6\u95F4 "),l(m,{label:"\u8FC7\u671F\u65F6\u95F4","header-align":"center",align:"center",prop:"expire_time",width:"180"},{default:i(c=>[b("span",null,_(c.row.expire_date||"-"),1)]),_:1}),d(" \u5907\u6CE8 "),l(m,{label:"\u5907\u6CE8","header-align":"center",align:"center",prop:"comment"},{default:i(c=>[b("span",null,_(c.row.comment||"-"),1)]),_:1}),d(" \u521B\u5EFA\u65F6\u95F4 "),l(m,{label:"\u521B\u5EFA\u65F6\u95F4","header-align":"center",align:"center",prop:"create_time",width:"120"},{default:i(c=>[b("span",null,_(c.row.create_time_label||"-"),1)]),_:1}),d(" \u64CD\u4F5C "),d(` <el-table-column
        label="\u72B6\u6001"
        header-align="center"
        align="center"
        width="80"
      >
        <template #default="scope">
          <el-switch
            v-model="scope.row.status"
            @change="handleStatusChange(scope.row, $event)"
          />
        </template>
      </el-table-column> `),d(" \u8BC1\u4E66 "),l(m,{label:"\u8BC1\u4E66\uFF08.zip\uFF09","header-align":"center",align:"center",prop:"ssl_certificate",width:"120"},{default:i(c=>[l(v,{underline:!1,type:"primary",class:"mr-sm",onClick:x=>n.downloadSSLFile(c.row)},{default:i(()=>[l(g,null,{default:i(()=>[l(u)]),_:1}),k(_(t.$t("\u70B9\u51FB\u4E0B\u8F7D")),1)]),_:2},1032,["onClick"])]),_:1}),l(m,{label:"\u64CD\u4F5C",width:"80","header-align":"center",align:"center"},{default:i(c=>[l(v,{underline:!1,type:"primary",class:"mr-sm",onClick:x=>n.handleEditRow(c.row)},{default:i(()=>[l(g,null,{default:i(()=>[l(D)]),_:1})]),_:2},1032,["onClick"]),l(V,{title:`${t.$t("\u786E\u5B9A\u5220\u9664")}\uFF1F`,onConfirm:x=>n.handleDeleteClick(c.row)},{reference:i(()=>[l(v,{underline:!1,type:"danger"},{default:i(()=>[l(g,null,{default:i(()=>[l(o)]),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),d(" \u7F16\u8F91\u6846 "),l(f,{visible:a.dialogVisible,"onUpdate:visible":e[0]||(e[0]=c=>a.dialogVisible=c),row:a.currentRow,onOnSuccess:n.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const ee=y(X,[["render",Y]]),te={name:"certificate-list",props:{},components:{DataFormDialog:F,DataTable:ee},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1}},computed:{},methods:{resetData(){this.page=1,this.getData()},async getData(){this.loading=!0;let t={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getCertificateList(t);e.code==0&&(this.list=e.data.list,this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()}},created(){this.getData()}},le={class:"app-container"},ae={class:"flex justify-between"};function ie(t,e,r,h,a,n){const m=s("Plus"),p=s("el-icon"),u=s("el-button"),g=s("Search"),v=s("el-input"),D=s("DataTable"),o=s("el-pagination"),V=s("DataFormDialog"),S=T("loading");return w(),C("div",le,[d(" \u64CD\u4F5C\u6309\u94AE "),b("div",ae,[l(u,{type:"primary",onClick:n.handleAddRow},{default:i(()=>[l(p,null,{default:i(()=>[l(m)]),_:1}),k(_(t.$t("\u6DFB\u52A0")),1)]),_:1},8,["onClick"]),l(v,{class:"ml-sm",style:{width:"260px"},modelValue:a.keyword,"onUpdate:modelValue":e[0]||(e[0]=f=>a.keyword=f),placeholder:"\u8F93\u5165\u57DF\u540D",clearable:"",onKeypress:z(n.handleSearch,["enter"]),onClear:n.handleSearch},{append:i(()=>[l(u,{onClick:n.handleSearch},{default:i(()=>[l(p,null,{default:i(()=>[l(g)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),d(" \u6570\u636E\u5217\u8868 "),A(l(D,{class:"mt-md",list:a.list,onOnSuccess:n.resetData,onOnEditRow:t.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[S,a.loading]]),d(" \u7FFB\u9875 "),l(o,{class:"mt-md justify-center",background:"",layout:"total, prev, pager, next",total:a.total,"page-size":a.size,"onUpdate:pageSize":e[1]||(e[1]=f=>a.size=f),"current-page":a.page,"onUpdate:currentPage":e[2]||(e[2]=f=>a.page=f),onCurrentChange:n.getData},null,8,["total","page-size","current-page","onCurrentChange"]),d(" \u7F16\u8F91\u6846 "),l(V,{visible:a.dialogVisible,"onUpdate:visible":e[3]||(e[3]=f=>a.dialogVisible=f),onOnSuccess:n.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const fe=y(te,[["render",ie]]);export{fe as default};
