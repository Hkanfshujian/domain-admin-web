import{t as F,_ as k}from"./index.6dc94d79.js";import{ah as r,o as _,O as S,P as n,V as t,c as V,F as R,a8 as E,a as w,S as s,T as O,U as b,ar as q,a9 as N,Q as P}from"./vendor-vue.cefe3aef.js";import{C as z}from"./ConnectStatus.1644e922.js";import{M as B}from"./monitor-status-enums.a7e73531.js";import"./element-plus.af689926.js";import"./element-icon.1fe9d2a8.js";import"./vendor-lib.a8c0b8df.js";const L={title:[{message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],monitor_type:[{message:"\u76D1\u63A7\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],interval:[{message:"\u68C0\u6D4B\u9891\u7387\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},x={UNKNOWN:0,HTTP:1},T=[{value:x.HTTP,label:F("HTTP")}],H=[{value:x.UNKNOWN,label:F("\u672A\u77E5")},...T];function A(o){var e;return(e=H.find(l=>l.value==o))==null?void 0:e.label}const j={GET:"GET",POST:"POST"},U=[{value:j.GET,label:F("GET")}],I={url:[{message:"URL\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],method:[{message:"\u8BF7\u6C42\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],timeout:[{message:"\u8D85\u65F6\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},K={name:"",props:{form:{type:Object,default:null}},components:{},data(){return{rules:I,MonitorTypeEnum:x,MonitorTypeOptions:T,RequestMethodOptions:U}},computed:{},methods:{handleSubmit(){console.log("handleSubmit"),this.$refs.form.validate(o=>{if(console.log(o),o)this.confirmSubmit();else return!1})},confirmSubmit(){console.debug("confirmSubmit",this.form),this.$emit("on-confirm",this.form)}},created(){}},G=w("span",{class:"ml-sm"},"\uFF08\u79D2\uFF09",-1);function W(o,e,l,y,a,i){const d=r("el-option"),f=r("el-select"),c=r("el-form-item"),g=r("el-input"),v=r("el-form");return _(),S(v,{ref:"form",model:l.form,rules:a.rules,"label-width":"100px"},{default:n(()=>[t(c,{label:"\u8BF7\u6C42\u65B9\u5F0F",prop:"method"},{default:n(()=>[t(f,{modelValue:l.form.method,"onUpdate:modelValue":e[0]||(e[0]=m=>l.form.method=m),style:{width:"140px"},disabled:""},{default:n(()=>[(_(!0),V(R,null,E(a.RequestMethodOptions,m=>(_(),S(d,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"\u8BF7\u6C42URL",prop:"url"},{default:n(()=>[t(g,{type:"text",modelValue:l.form.url,"onUpdate:modelValue":e[1]||(e[1]=m=>l.form.url=m),placeholder:"\u8BF7\u8F93\u5165\u8BF7\u6C42URL"},null,8,["modelValue"])]),_:1}),t(c,{label:"\u8BF7\u6C42\u8D85\u65F6",prop:"timeout"},{default:n(()=>[t(g,{style:{width:"140px"},type:"number",modelValue:l.form.timeout,"onUpdate:modelValue":e[2]||(e[2]=m=>l.form.timeout=m),placeholder:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u95F4"},null,8,["modelValue"]),G]),_:1})]),_:1},8,["model","rules"])}const Q=k(K,[["render",W]]),J={name:"",props:{row:{type:Object,default:null}},components:{HttpDataForm:Q},data(){return{rules:L,MonitorTypeEnum:x,MonitorTypeOptions:T,RequestMethodOptions:U,form:{title:"",monitor_type:T[0].value,content:{method:U[0].value,url:"",timeout:3},interval:"60",status:"",is_active:!0,next_run_time:""}}},computed:{},methods:{async getData(){if(this.row){let o={monitor_id:this.row.id};const e=await this.$http.getMonitorById(o);if(e.code!=0)return;let l=e.data;this.form.title=l.title,this.form.monitor_type=l.monitor_type,this.form.content=l.content,this.form.interval=l.interval}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.MonitorDataForm.handleSubmit()},handleMonitorDataFormConfirm(){this.$refs.form.validate(o=>{if(o)this.confirmSubmit();else return!1})},async confirmSubmit(){console.log("handleMonitorDataFormConfirm");let o=this.$loading({fullscreen:!0}),e={title:this.form.title,monitor_type:this.form.monitor_type,content:this.form.content,interval:this.form.interval},l=null;this.row&&this.row.id?l=await this.$http.updateMonitorById({...e,monitor_id:this.row.id}):l=await this.$http.addMonitor(e),l.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(l.msg),this.$nextTick(()=>{o.close()})}},created(){this.getData()}},X=w("span",{class:"ml-sm"},"(\u5206\u949F)",-1),Y={class:"text-center"};function Z(o,e,l,y,a,i){const d=r("el-input"),f=r("el-form-item"),c=r("el-option"),g=r("el-select"),v=r("HttpDataForm"),m=r("el-form"),D=r("el-button");return _(),V("div",null,[t(m,{ref:"form",model:a.form,rules:a.rules,"label-width":"100px"},{default:n(()=>[s(" \u6807\u9898 "),t(f,{label:"\u540D\u79F0",prop:"title"},{default:n(()=>[t(d,{type:"text",modelValue:a.form.title,"onUpdate:modelValue":e[0]||(e[0]=p=>a.form.title=p),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),s(" \u76D1\u63A7\u7C7B\u578B "),t(f,{label:"\u76D1\u63A7\u7C7B\u578B",prop:"monitor_type"},{default:n(()=>[t(g,{modelValue:a.form.monitor_type,"onUpdate:modelValue":e[1]||(e[1]=p=>a.form.monitor_type=p),style:{width:"140px"},disabled:""},{default:n(()=>[(_(!0),V(R,null,E(a.MonitorTypeOptions,p=>(_(),S(c,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(" \u76D1\u63A7\u53C2\u6570 "),s(` <el-form-item
        label="\u76D1\u63A7\u53C2\u6570"
        prop="content"
      >
        <el-input
          type="text"
          v-model="form.content"
          placeholder="\u8BF7\u8F93\u5165\u76D1\u63A7\u53C2\u6570"
        ></el-input>
      </el-form-item> `),s(" \u76D1\u63A7\u53C2\u6570 "),a.MonitorTypeEnum.HTTP==a.form.monitor_type?(_(),S(v,{key:0,ref:"MonitorDataForm",form:a.form.content,onOnConfirm:i.handleMonitorDataFormConfirm},null,8,["form","onOnConfirm"])):s("v-if",!0),s(" \u68C0\u6D4B\u9891\u7387 "),t(f,{label:"\u68C0\u6D4B\u9891\u7387",prop:"interval"},{default:n(()=>[t(d,{style:{width:"140px"},type:"number",modelValue:a.form.interval,"onUpdate:modelValue":e[2]||(e[2]=p=>a.form.interval=p),placeholder:"\u8BF7\u8F93\u5165\u68C0\u6D4B\u9891\u7387"},null,8,["modelValue"]),X]),_:1}),s(" \u542F\u7528 "),s(` <el-form-item
        label="\u542F\u7528"
        prop="is_active"
      >
        <el-switch v-model="form.is_active" />
      </el-form-item> `)]),_:1},8,["model","rules"]),s(" \u64CD\u4F5C "),w("div",Y,[t(D,{onClick:i.handleCancel},{default:n(()=>[O(b(o.$t("\u53D6\u6D88")),1)]),_:1},8,["onClick"]),t(D,{type:"primary",onClick:i.handleSubmit},{default:n(()=>[O(b(o.$t("\u786E\u5B9A")),1)]),_:1},8,["onClick"])])])}const ee=k(J,[["render",Z]]),te={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:ee},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(o){this.$emit("update:visible",o)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function le(o,e,l,y,a,i){const d=r("DataForm"),f=r("el-dialog");return _(),V(R,null,[s(" \u7F16\u8F91\u6846 "),t(f,{title:i.dialogTitle,modelValue:i.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=c=>i.dialogVisible=c),width:"600px",center:"","append-to-body":""},{default:n(()=>[i.dialogVisible?(_(),S(d,{key:0,row:l.row,onOnCancel:i.handleClose,onOnSuccess:i.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):s("v-if",!0)]),_:1},8,["title","modelValue"])],2112)}const $=k(te,[["render",le]]),ne={name:"",components:{DataFormDialog:$,ConnectStatus:z},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(o){this.currentRow=o,this.dialogVisible=!0},async handleDeleteClick(o){let e={monitor_id:o.id};const l=await this.$http.removeMonitorById(e);l.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(l.msg)},async handleStatusChange(o,e){let l={monitor_id:o.id,is_active:e};const y=await this.$http.updateMonitorActive(l);y.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(y.msg)},handleUpdateSuccess(){this.$emit("on-success")},handleOpenLogClick(o){let e=this.$router.resolve({name:"log-monitor-list",query:{monitorId:o.id}});window.open(e.href,"_blank")}},created(){}},oe={key:1};function ae(o,e,l,y,a,i){const d=r("el-table-column"),f=r("ConnectStatus"),c=r("el-link"),g=r("el-switch"),v=r("Edit"),m=r("el-icon"),D=r("Delete"),p=r("el-popconfirm"),M=r("el-table"),h=r("DataFormDialog");return _(),V("div",null,[t(M,{data:l.list,stripe:"",border:""},{default:n(()=>[s(` <el-table-column
        label="ID"
        align="center"
        prop="id"
        width="60"
      >
        <template #default="scope">
          <span>{{ scope.row.id || '-' }}</span>
        </template>
      </el-table-column> `),s(" \u6807\u9898 "),t(d,{label:"\u540D\u79F0","header-align":"center",align:"center",prop:"title"},{default:n(u=>[w("span",null,b(u.row.title||"-"),1)]),_:1}),s(" \u76D1\u63A7\u7C7B\u578B "),t(d,{label:"\u76D1\u63A7\u7C7B\u578B","header-align":"center",align:"center",prop:"monitor_type",width:"100"},{default:n(u=>[w("span",null,b(u.row.monitor_type_label||"-"),1)]),_:1}),s(" \u76D1\u63A7\u53C2\u6570 "),s(` <el-table-column
        label="\u76D1\u63A7\u53C2\u6570"
        header-align="center"
        align="center"
        prop="content"
      >
        <template #default="scope">
          <span>{{ scope.row.content || '-' }}</span>
        </template>
      </el-table-column> `),s(" \u68C0\u6D4B\u9891\u7387 "),t(d,{label:"\u9891\u7387(\u5206\u949F)","header-align":"center",align:"center",prop:"interval",width:"100"},{default:n(u=>[w("span",null,b(u.row.interval||"-"),1)]),_:1}),s(" \u72B6\u6001 "),t(d,{label:"\u72B6\u6001","header-align":"center",align:"center",prop:"status",width:"100"},{default:n(u=>[t(f,{value:u.row.status_value,onOnClick:C=>i.handleOpenLogClick(u.row)},null,8,["value","onOnClick"])]),_:1}),t(d,{label:"\u65E5\u5FD7","header-align":"center",align:"center",prop:"interval",width:"100"},{default:n(u=>[u.row.log_count&&u.row.log_count>0?(_(),S(c,{key:0,underline:!1,onClick:C=>i.handleOpenLogClick(u.row)},{default:n(()=>[O(b(u.row.log_count),1)]),_:2},1032,["onClick"])):(_(),V("span",oe,"-"))]),_:1}),s(" \u4E0B\u6B21\u8FD0\u884C\u65F6\u95F4 "),t(d,{label:"\u4E0B\u6B21\u8FD0\u884C\u65F6\u95F4","header-align":"center",align:"center",prop:"next_run_time",width:"180"},{default:n(u=>[w("span",null,b(u.row.next_run_time||"-"),1)]),_:1}),s(" \u64CD\u4F5C "),t(d,{label:"\u542F\u7528","header-align":"center",align:"center",width:"80"},{default:n(u=>[t(g,{modelValue:u.row.is_active,"onUpdate:modelValue":C=>u.row.is_active=C,onChange:C=>i.handleStatusChange(u.row,C)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(d,{label:"\u7F16\u8F91",width:"60","header-align":"center",align:"center"},{default:n(u=>[t(c,{underline:!1,type:"primary",onClick:C=>i.handleEditRow(u.row)},{default:n(()=>[t(m,null,{default:n(()=>[t(v)]),_:1})]),_:2},1032,["onClick"])]),_:1}),t(d,{label:"\u5220\u9664",width:"60",align:"center",prop:"tag"},{default:n(u=>[t(p,{title:`${o.$t("\u786E\u5B9A\u5220\u9664")}\uFF1F`,onConfirm:C=>i.handleDeleteClick(u.row)},{reference:n(()=>[t(c,{underline:!1,type:"danger"},{default:n(()=>[t(m,null,{default:n(()=>[t(D)]),_:1})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),s(" \u7F16\u8F91\u6846 "),t(h,{visible:a.dialogVisible,"onUpdate:visible":e[0]||(e[0]=u=>a.dialogVisible=u),row:a.currentRow,onOnSuccess:i.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const re=k(ne,[["render",ae]]),ie={name:"monitor-list",props:{},components:{DataFormDialog:$,DataTable:re},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1}},computed:{},methods:{resetData(){this.page=1,this.getData()},async getData(){this.loading=!0;let o={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getMonitorList(o);e.code==0&&(this.list=e.data.list.map(l=>(l.monitor_type_label=A(l.monitor_type),l.status_value=B(l.status),l)),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()}},created(){this.getData()}},se={class:"app-container"},ue={class:"flex justify-between"};function de(o,e,l,y,a,i){const d=r("Plus"),f=r("el-icon"),c=r("el-button"),g=r("Search"),v=r("el-input"),m=r("DataTable"),D=r("el-pagination"),p=r("DataFormDialog"),M=q("loading");return _(),V("div",se,[s(" \u64CD\u4F5C\u6309\u94AE "),w("div",ue,[t(c,{type:"primary",onClick:i.handleAddRow},{default:n(()=>[t(f,null,{default:n(()=>[t(d)]),_:1}),O(b(o.$t("\u6DFB\u52A0")),1)]),_:1},8,["onClick"]),t(v,{class:"ml-sm",style:{width:"260px"},modelValue:a.keyword,"onUpdate:modelValue":e[0]||(e[0]=h=>a.keyword=h),placeholder:"\u8F93\u5165\u540D\u79F0",clearable:"",onKeypress:N(i.handleSearch,["enter"]),onClear:i.handleSearch},{append:n(()=>[t(c,{onClick:i.handleSearch},{default:n(()=>[t(f,null,{default:n(()=>[t(g)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),s(" \u6570\u636E\u5217\u8868 "),P(t(m,{class:"mt-md",list:a.list,onOnSuccess:i.resetData,onOnEditRow:o.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[M,a.loading]]),s(" \u7FFB\u9875 "),t(D,{class:"mt-md justify-center",background:"",layout:"total, prev, pager, next",total:a.total,"page-size":a.size,"onUpdate:pageSize":e[1]||(e[1]=h=>a.size=h),"current-page":a.page,"onUpdate:currentPage":e[2]||(e[2]=h=>a.page=h),onCurrentChange:i.getData},null,8,["total","page-size","current-page","onCurrentChange"]),s(" \u7F16\u8F91\u6846 "),t(p,{visible:a.dialogVisible,"onUpdate:visible":e[3]||(e[3]=h=>a.dialogVisible=h),onOnSuccess:i.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const be=k(ie,[["render",de]]);export{be as default};
